class ApplicationController < ActionController::Base
  add_flash_types :error, :success, :notice
  # Only allow modern browsers supporting webp images, web push, badges, import maps, CSS nesting, and CSS :has.
  allow_browser versions: :modern

  protected

  def <%=SunSword.scope_owner_column%>
    current_auth.account.id
  end

  def build_contract(params)
    { <%=SunSword.scope_owner_column.to_s%>: <%=SunSword.scope_owner_column.to_s%> }.merge(params)
  end

  def build_form_errors(params, model, errors)
    params.keys.each do |key|
      model[key] = params[key]
    end
    if errors.is_a?(Hash)
      errors.keys.each do |key|
        model.errors.add(key, :invalid, message: errors[key][0])
      end
    elsif errors.is_a?(Array)
      errors.each do |error|
        if error.options.present?
          model.errors.add(error.attribute, error.type, message: error.options['message'])
        else
          model.errors.add(error.attribute, error.type)
        end
      end
    end
    model
  end

  def set_layouts
    # "#{current_auth.user.role}/application"
    "owner/application"
  end
end
